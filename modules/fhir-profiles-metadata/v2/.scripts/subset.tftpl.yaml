%{ if version != null ~}
%{ if contains(["dedicated", "combined"], provisioning_mode) && length(versions) > 1 ~}
- name: ${replace(format("%s-%s", version, profile_type), ".", "-")}
  labels:
    fhirProfile: ${profile_type}
    fhirProfileVersion: ${replace(format("%s-%s", version, profile_type), ".", "-")}
    version: ${version}
  mode: dedicated
  weight: ${weight}
%{ endif ~}
%{ if contains(["distributed", "combined"], provisioning_mode) || length(versions) == 1 ~}
%{ for idx, v in versions ~}
- name: ${replace(replace(format("%s-%s-%s", version, profile_type, v), ".", "-"),"_","-")}
  labels:
    fhirProfile: ${profile_type}
    fhirProfileVersion: ${v}
    version: ${version}
  mode: distributed
%{ if length(extra_versions) > 0 && !contains(extra_versions, v) ~}
  weight: 0
%{ else ~}
  weight: ${weight}
%{ endif ~}
%{ endfor ~}
%{ endif ~}
%{ else ~}
[]
%{ endif ~}
