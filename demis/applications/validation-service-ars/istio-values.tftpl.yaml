# Application Information
appName: "validation-service-ars"
appNamespace: "${namespace}" # defaults to Release.Namespace
# Settings for the Kubernetes Service Object for the Application
appServiceType: ClusterIP
appServicePortExternal: 8080
appServicePortTarget: 8080
appServicePortProtocol: TCP
appServicePortName: http

# Istio Information

# If true, the VirtualService will be created as a delegate Virtual Service, so the "host" will not be set
# See https://istio.io/latest/docs/reference/config/networking/virtual-service/#VirtualService
isDelegate: true

%{ if profile_handling_api_version == "v1" ~}
# HTTP Rules for internal endpoints - https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRoute
# The "route" part is generated using the destination subset information
CustomVirtualServiceHttpRules: >-
  - {{ include "routing.service.destination.subsets" . }}

${destinationSubsets}
%{ else ~}
# HTTP Rules for internal endpoints - https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRoute
%{ if custom_virtual_service_http_rules != null && length(custom_virtual_service_http_rules) > 0 ~}
CustomVirtualServiceHttpRules: >-
  ${indent(2, custom_virtual_service_http_rules)}
%{ endif ~}

%{ if custom_destination_subsets != null && length(custom_destination_subsets) > 0 ~}
CustomDestinationSubsets: >-
%{ for subset in custom_destination_subsets.main ~}
  - name: ${subset.name}
    labels:
%{ for key, value in subset.labels ~}
      ${key}: ${value}
%{ endfor ~}
%{ endfor ~}
%{ for subset in custom_destination_subsets.canary ~}
  - name: ${subset.name}
    labels:
%{ for key, value in subset.labels ~}
      ${key}: ${value}
%{ endfor ~}
%{ endfor ~}
%{ endif ~}
%{ endif ~}