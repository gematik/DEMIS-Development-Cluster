# Application Information
appName: "validation-service"
appNamespace: "${namespace}" # defaults to Release.Namespace
# Settings for the Kubernetes Service Object for the Application
appServiceType: ClusterIP
appServicePortExternal: 8080
appServicePortTarget: 8080
appServicePortProtocol: TCP
appServicePortName: http

# Istio Information

# HTTP Rules for internal endpoints - https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRoute
# The "route" part is generated using the destination subset information

virtualServiceHttpRules:
%{ for profile in [ "", "igs", "ars"] ~}
  - match:
    - headers:
        x-fhir-profile:
          exact: ${coalesce(profile,"fhir")}-profile-snapshots
      uri:
        prefix: /
    - headers:
        fhirProfile:
          exact: ${coalesce(profile,"fhir")}-profile-snapshots
      uri:
        prefix: /
    rewrite:
      uri: /
    delegate:
      name: validation-service-${coalesce(profile,"core")}-internal
      namespace: ${namespace}
%{ if http_timeout_retry_block[coalesce(profile,"core")] != null ~}
    ${indent(4, http_timeout_retry_block[coalesce(profile,"core")])}
%{ endif ~}
%{ endfor ~}
  - match:
    - uri:
        prefix: /
    rewrite:
      uri: /
    delegate:
      name: validation-service-core-internal
      namespace: ${namespace}
%{ if http_timeout_retry_block["core"] != null ~}
    ${indent(4, http_timeout_retry_block["core"])}
%{ endif ~}